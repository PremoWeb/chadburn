<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Advanced Topics | Chadburn Documentation</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Advanced Topics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Modern job scheduler for Docker environments" />
<meta property="og:description" content="Modern job scheduler for Docker environments" />
<link rel="canonical" href="https://premoweb.github.io/Chadburn/advanced-topics.html" />
<meta property="og:url" content="https://premoweb.github.io/Chadburn/advanced-topics.html" />
<meta property="og:site_name" content="Chadburn Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Advanced Topics" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Modern job scheduler for Docker environments","headline":"Advanced Topics","url":"https://premoweb.github.io/Chadburn/advanced-topics.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/Chadburn/assets/css/style.css?v=01407121e028b55899dce39b1f6366f362a03831">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->


<!-- You can set your favicon here -->
<link rel="shortcut icon" type="image/x-icon" href="/Chadburn/assets/images/favicon.ico">

<!-- end custom head snippets --> 
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Advanced Topics</h1>
      <h2 class="project-tagline">Modern job scheduler for Docker environments</h2>
      
        <a href="https://github.com/PremoWeb/Chadburn" class="btn">View on GitHub</a>
      
      
      <div class="header-links">
        
          
          <a href="/Chadburn/getting-started.md.html" class="btn">Getting started.md</a>
        
          
          <a href="/Chadburn/configuration.md.html" class="btn">Configuration.md</a>
        
          
          <a href="/Chadburn/jobs.md.html" class="btn">Jobs.md</a>
        
          
          <a href="/Chadburn/docker-integration.md.html" class="btn">Docker integration.md</a>
        
          
          <a href="/Chadburn/troubleshooting.md.html" class="btn">Troubleshooting.md</a>
        
          
          <a href="/Chadburn/advanced-topics.md.html" class="btn">Advanced topics.md</a>
        
          
          <a href="/Chadburn/deployment.md.html" class="btn">Deployment.md</a>
        
          
          <a href="/Chadburn/security.md.html" class="btn">Security.md</a>
        
          
          <a href="/Chadburn/examples.md.html" class="btn">Examples.md</a>
        
          
          <a href="/Chadburn/faq.md.html" class="btn">Faq.md</a>
        
          
          <a href="/Chadburn/contributing.md.html" class="btn">Contributing.md</a>
        
      </div>
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="advanced-topics">Advanced Topics</h1>

<p>This document covers advanced features and concepts in Chadburn for users who want to get the most out of the system.</p>

<h2 id="middlewares">Middlewares</h2>

<p>Chadburn uses middlewares to extend job functionality. Middlewares are executed before and after job execution, allowing for notifications, logging, and other cross-cutting concerns.</p>

<h3 id="built-in-middlewares">Built-in Middlewares</h3>

<h4 id="slack-notifications">Slack Notifications</h4>

<p>Sends job execution notifications to Slack:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[global]</span>
<span class="py">slack-webhook</span> <span class="p">=</span> <span class="s">https://hooks.slack.com/services/XXX/YYY/ZZZ</span>
<span class="py">slack-only-on-error</span> <span class="p">=</span> <span class="s">true</span>
</code></pre></div></div>

<h4 id="email-notifications">Email Notifications</h4>

<p>Sends job execution notifications via email:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[global]</span>
<span class="py">smtp-host</span> <span class="p">=</span> <span class="s">smtp.example.com</span>
<span class="py">smtp-port</span> <span class="p">=</span> <span class="s">587</span>
<span class="py">smtp-user</span> <span class="p">=</span> <span class="s">user</span>
<span class="py">smtp-password</span> <span class="p">=</span> <span class="s">password</span>
<span class="py">email-to</span> <span class="p">=</span> <span class="s">alerts@example.com</span>
<span class="py">email-from</span> <span class="p">=</span> <span class="s">chadburn@example.com</span>
<span class="py">mail-only-on-error</span> <span class="p">=</span> <span class="s">true</span>
</code></pre></div></div>

<h4 id="execution-logging">Execution Logging</h4>

<p>Saves job execution logs to a directory:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[global]</span>
<span class="py">save-folder</span> <span class="p">=</span> <span class="s">/var/log/chadburn</span>
<span class="py">save-only-on-error</span> <span class="p">=</span> <span class="s">false</span>
</code></pre></div></div>

<h4 id="gotify-notifications">Gotify Notifications</h4>

<p>Sends job execution notifications to a Gotify server:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[global]</span>
<span class="py">gotify-url</span> <span class="p">=</span> <span class="s">https://gotify.example.com</span>
<span class="py">gotify-token</span> <span class="p">=</span> <span class="s">YourGotifyToken</span>
<span class="py">gotify-only-on-error</span> <span class="p">=</span> <span class="s">true</span>
</code></pre></div></div>

<h3 id="middleware-behavior">Middleware Behavior</h3>

<p>Middlewares are executed in the following order:</p>

<ol>
  <li>Global middlewares (defined in the <code class="language-plaintext highlighter-rouge">[global]</code> section)</li>
  <li>Job-specific middlewares (if any)</li>
</ol>

<p>Each middleware can:</p>
<ul>
  <li>Perform actions before job execution</li>
  <li>Modify the execution context</li>
  <li>Perform actions after job execution</li>
  <li>Access execution results and logs</li>
</ul>

<h2 id="variable-substitution">Variable Substitution</h2>

<p>Chadburn supports variable substitution in job commands, allowing for dynamic command generation.</p>

<h3 id="available-variables">Available Variables</h3>

<h4 id="container-variables">Container Variables</h4>

<p>For <code class="language-plaintext highlighter-rouge">job-exec</code> and <code class="language-plaintext highlighter-rouge">job-run</code>:</p>

<ul>
  <li>``: Container name</li>
  <li>``: Container ID</li>
  <li>``: Container image name</li>
  <li>``: Container state</li>
</ul>

<h4 id="time-variables">Time Variables</h4>

<p>For all job types:</p>

<ul>
  <li>``: Current time (format: <code class="language-plaintext highlighter-rouge">2006-01-02T15:04:05Z07:00</code>)</li>
  <li>``: Current UTC time</li>
  <li>``: Current time with custom format</li>
</ul>

<h4 id="environment-variables">Environment Variables</h4>

<p>For all job types:</p>

<ul>
  <li>``: Value of the environment variable</li>
</ul>

<h3 id="examples">Examples</h3>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-exec "backup-with-timestamp"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">app</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">tar -czf /backups/data-.tar.gz /data</span>

<span class="nn">[job-exec "container-info"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@hourly</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">app</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">echo "Running in  ()"</span>

<span class="nn">[job-local "env-example"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">echo "Database: "</span>
</code></pre></div></div>

<h2 id="metrics-and-monitoring">Metrics and Monitoring</h2>

<p>Chadburn provides Prometheus-compatible metrics for monitoring job executions.</p>

<h3 id="enabling-metrics">Enabling Metrics</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">--name</span> chadburn <span class="se">\</span>
  <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock:ro,z <span class="se">\</span>
  <span class="nt">-v</span> /path/to/config.ini:/etc/chadburn.conf <span class="se">\</span>
  <span class="nt">-p</span> 8080:8080 <span class="se">\</span>
  premoweb/chadburn:latest daemon <span class="nt">--metrics</span>
</code></pre></div></div>

<h3 id="available-metrics">Available Metrics</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">chadburn_scheduler_jobs</code>: Active job count registered on the scheduler</li>
  <li><code class="language-plaintext highlighter-rouge">chadburn_scheduler_register_errors_total</code>: Total number of failed scheduler registrations</li>
  <li><code class="language-plaintext highlighter-rouge">chadburn_run_total</code>: Total number of completed job runs (labeled by job name)</li>
  <li><code class="language-plaintext highlighter-rouge">chadburn_run_errors_total</code>: Total number of completed job runs that resulted in an error (labeled by job name)</li>
  <li><code class="language-plaintext highlighter-rouge">chadburn_run_latest_timestamp</code>: Last time a job run completed (labeled by job name)</li>
  <li><code class="language-plaintext highlighter-rouge">chadburn_run_duration_seconds</code>: Duration of all runs (labeled by job name)</li>
</ul>

<h3 id="prometheus-configuration">Prometheus Configuration</h3>

<p>Example Prometheus configuration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">chadburn'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">chadburn:8080'</span><span class="pi">]</span>
</code></pre></div></div>

<h3 id="grafana-dashboard">Grafana Dashboard</h3>

<p>You can create a Grafana dashboard to visualize Chadburn metrics:</p>

<ul>
  <li>Job success/failure rates</li>
  <li>Job execution durations</li>
  <li>Job execution timestamps</li>
  <li>Error counts</li>
</ul>

<h2 id="job-execution-context">Job Execution Context</h2>

<p>Each job execution has a context that contains information about the job, execution environment, and results.</p>

<h3 id="context-properties">Context Properties</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Job</code>: The job being executed</li>
  <li><code class="language-plaintext highlighter-rouge">Execution</code>: Execution details (start time, end time, error, etc.)</li>
  <li><code class="language-plaintext highlighter-rouge">Logger</code>: Logger instance for the job</li>
</ul>

<h3 id="execution-lifecycle">Execution Lifecycle</h3>

<ol>
  <li>Job is scheduled based on its cron expression</li>
  <li>Execution context is created</li>
  <li>Pre-execution middlewares are run</li>
  <li>Job command is executed</li>
  <li>Post-execution middlewares are run</li>
  <li>Execution results are stored</li>
</ol>

<h3 id="execution-timeouts">Execution Timeouts</h3>

<p>By default, job executions don’t have a timeout. You can set a timeout for a job:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-exec "long-running-task"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">app</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">/path/to/long-script.sh</span>
<span class="py">timeout</span> <span class="p">=</span> <span class="s">1h</span>
</code></pre></div></div>

<h2 id="advanced-docker-integration">Advanced Docker Integration</h2>

<h3 id="container-networks">Container Networks</h3>

<p>For <code class="language-plaintext highlighter-rouge">job-run</code> and <code class="language-plaintext highlighter-rouge">job-service-run</code>, you can specify the network:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-run "network-example"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">image</span> <span class="p">=</span> <span class="s">ubuntu:latest</span>
<span class="py">network</span> <span class="p">=</span> <span class="s">my-network</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">ping -c 3 other-container</span>
</code></pre></div></div>

<h3 id="volume-mounts">Volume Mounts</h3>

<p>For <code class="language-plaintext highlighter-rouge">job-run</code> and <code class="language-plaintext highlighter-rouge">job-service-run</code>, you can mount volumes:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-run "volume-example"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">image</span> <span class="p">=</span> <span class="s">ubuntu:latest</span>
<span class="py">volumes</span> <span class="p">=</span> <span class="s">["/host/path:/container/path", "/tmp:/tmp"]</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">ls -la /container/path</span>
</code></pre></div></div>

<h3 id="user-specification">User Specification</h3>

<p>For <code class="language-plaintext highlighter-rouge">job-exec</code>, <code class="language-plaintext highlighter-rouge">job-run</code>, and <code class="language-plaintext highlighter-rouge">job-service-run</code>, you can specify the user:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-exec "user-example"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">app</span>
<span class="py">user</span> <span class="p">=</span> <span class="s">www-data</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">touch /var/www/file.txt</span>
</code></pre></div></div>

<h3 id="working-directory">Working Directory</h3>

<p>For <code class="language-plaintext highlighter-rouge">job-exec</code>, <code class="language-plaintext highlighter-rouge">job-run</code>, and <code class="language-plaintext highlighter-rouge">job-service-run</code>, you can specify the working directory:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-exec "workdir-example"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">app</span>
<span class="py">working-dir</span> <span class="p">=</span> <span class="s">/app</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">./run-script.sh</span>
</code></pre></div></div>

<h2 id="hybrid-configuration-strategies">Hybrid Configuration Strategies</h2>

<p>Chadburn supports both static (INI file) and dynamic (Docker labels) configuration. Here are some strategies for combining them:</p>

<h3 id="core-jobs-in-ini-dynamic-jobs-in-labels">Core Jobs in INI, Dynamic Jobs in Labels</h3>

<p>Use the INI file for critical jobs that should always run, and Docker labels for application-specific jobs that may change.</p>

<h3 id="global-settings-in-ini-jobs-in-labels">Global Settings in INI, Jobs in Labels</h3>

<p>Use the INI file for global settings (notifications, logging) and Docker labels for all job definitions.</p>

<h3 id="development-vs-production">Development vs. Production</h3>

<p>Use Docker labels in development for easy changes, and INI files in production for version-controlled configurations.</p>

<h2 id="security-considerations">Security Considerations</h2>

<h3 id="principle-of-least-privilege">Principle of Least Privilege</h3>

<ul>
  <li>Run Chadburn with read-only access to the Docker socket when possible</li>
  <li>Use specific users for job execution instead of root</li>
  <li>Limit the commands that can be executed</li>
</ul>

<h3 id="sensitive-information">Sensitive Information</h3>

<ul>
  <li>Avoid putting sensitive information in Docker labels (they’re visible in <code class="language-plaintext highlighter-rouge">docker inspect</code>)</li>
  <li>Use environment variables or configuration files for sensitive data</li>
  <li>Consider using Docker secrets for credentials</li>
</ul>

<h3 id="network-isolation">Network Isolation</h3>

<ul>
  <li>Run Chadburn in its own network namespace</li>
  <li>Only expose the metrics port if needed</li>
  <li>Use network policies to restrict access to the metrics endpoint</li>
</ul>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/PremoWeb/Chadburn">chadburn</a> is maintained by <a href="https://github.com/PremoWeb">PremoWeb</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html> 