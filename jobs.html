<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Jobs reference | Chadburn Documentation</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Jobs reference" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Modern job scheduler for Docker environments" />
<meta property="og:description" content="Modern job scheduler for Docker environments" />
<link rel="canonical" href="https://premoweb.github.io/Chadburn/jobs.html" />
<meta property="og:url" content="https://premoweb.github.io/Chadburn/jobs.html" />
<meta property="og:site_name" content="Chadburn Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Jobs reference" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Modern job scheduler for Docker environments","headline":"Jobs reference","url":"https://premoweb.github.io/Chadburn/jobs.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/Chadburn/assets/css/style.css?v=01407121e028b55899dce39b1f6366f362a03831">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->


<!-- You can set your favicon here -->
<link rel="shortcut icon" type="image/x-icon" href="/Chadburn/assets/images/favicon.ico">

<!-- end custom head snippets --> 
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Jobs reference</h1>
      <h2 class="project-tagline">Modern job scheduler for Docker environments</h2>
      
        <a href="https://github.com/PremoWeb/Chadburn" class="btn">View on GitHub</a>
      
      
      <div class="header-links">
        
          
          <a href="/Chadburn/getting-started.md.html" class="btn">Getting started.md</a>
        
          
          <a href="/Chadburn/configuration.md.html" class="btn">Configuration.md</a>
        
          
          <a href="/Chadburn/jobs.md.html" class="btn">Jobs.md</a>
        
          
          <a href="/Chadburn/docker-integration.md.html" class="btn">Docker integration.md</a>
        
          
          <a href="/Chadburn/troubleshooting.md.html" class="btn">Troubleshooting.md</a>
        
          
          <a href="/Chadburn/advanced-topics.md.html" class="btn">Advanced topics.md</a>
        
          
          <a href="/Chadburn/deployment.md.html" class="btn">Deployment.md</a>
        
          
          <a href="/Chadburn/security.md.html" class="btn">Security.md</a>
        
          
          <a href="/Chadburn/examples.md.html" class="btn">Examples.md</a>
        
          
          <a href="/Chadburn/faq.md.html" class="btn">Faq.md</a>
        
          
          <a href="/Chadburn/contributing.md.html" class="btn">Contributing.md</a>
        
      </div>
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="jobs-reference">Jobs reference</h1>

<ul>
  <li><a href="#job-exec">job-exec</a></li>
  <li><a href="#job-run">job-run</a></li>
  <li><a href="#job-local">job-local</a></li>
  <li><a href="#job-service-run">job-service-run</a></li>
  <li><a href="#variable-substitution">Variable Substitution</a></li>
</ul>

<h2 id="job-types">Job Types</h2>

<p>Chadburn supports several job types:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">job-local</code>: Executes commands on the host machine.</li>
  <li><code class="language-plaintext highlighter-rouge">job-exec</code>: Executes commands inside a running container.</li>
  <li><code class="language-plaintext highlighter-rouge">job-run</code>: Creates a new container to execute commands.</li>
  <li><code class="language-plaintext highlighter-rouge">job-service-run</code>: Creates a service to execute commands.</li>
  <li><code class="language-plaintext highlighter-rouge">job-lifecycle</code>: Executes commands on container lifecycle events (start/stop).</li>
</ul>

<h3 id="job-lifecycle">job-lifecycle</h3>

<p>The <code class="language-plaintext highlighter-rouge">job-lifecycle</code> type allows you to execute commands when a container starts or stops. This is useful for sending notifications, performing cleanup, or triggering other actions based on container lifecycle events.</p>

<p>Unlike other job types, <code class="language-plaintext highlighter-rouge">job-lifecycle</code> jobs don’t run on a schedule. Instead, they run once when the specified container lifecycle event occurs.</p>

<h4 id="configuration">Configuration</h4>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">[job-lifecycle</span> <span class="err">"notify-on-start"]</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">"my-container"</span>
<span class="py">event-type</span> <span class="p">=</span> <span class="s">"start"</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">"echo 'Container my-container started' | mail -s 'Container Started' admin@example.com"</span>

<span class="err">[job-lifecycle</span> <span class="err">"cleanup-on-stop"]</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">"my-container"</span>
<span class="py">event-type</span> <span class="p">=</span> <span class="s">"stop"</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">"echo 'Container my-container stopped' | mail -s 'Container Stopped' admin@example.com"</span>
</code></pre></div></div>

<h4 id="docker-compose-labels">Docker Compose Labels</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">my-service</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">chadburn.enabled</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">chadburn.job-lifecycle.notify-on-start.command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">'Container</span><span class="nv">  </span><span class="s">started'</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">mail</span><span class="nv"> </span><span class="s">-s</span><span class="nv"> </span><span class="s">'Container</span><span class="nv"> </span><span class="s">Started'</span><span class="nv"> </span><span class="s">admin@example.com"</span>
      <span class="na">chadburn.job-lifecycle.notify-on-start.event-type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">start"</span>
      <span class="na">chadburn.job-lifecycle.cleanup-on-stop.command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">'Container</span><span class="nv">  </span><span class="s">stopped'</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">mail</span><span class="nv"> </span><span class="s">-s</span><span class="nv"> </span><span class="s">'Container</span><span class="nv"> </span><span class="s">Stopped'</span><span class="nv"> </span><span class="s">admin@example.com"</span>
      <span class="na">chadburn.job-lifecycle.cleanup-on-stop.event-type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stop"</span>
</code></pre></div></div>

<h4 id="parameters">Parameters</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">container</code>: The name or ID of the container to monitor.</li>
  <li><code class="language-plaintext highlighter-rouge">event-type</code>: The type of event to trigger on. Valid values are <code class="language-plaintext highlighter-rouge">start</code> and <code class="language-plaintext highlighter-rouge">stop</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">command</code>: The command to execute when the event occurs.</li>
</ul>

<h4 id="variables">Variables</h4>

<p>You can use the following variables in your commands:</p>

<ul>
  <li>``: The name of the container.</li>
  <li>``: The ID of the container.</li>
</ul>

<h2 id="job-exec">Job-exec</h2>

<p>This job is executed inside a running container. Similar to <code class="language-plaintext highlighter-rouge">docker exec</code></p>

<h3 id="parameters-1">Parameters</h3>

<ul>
  <li><strong>Schedule</strong> *
    <ul>
      <li><em>description</em>: When the job should be executed. E.g. every 10 seconds or every night at 1 AM.</li>
      <li><em>value</em>: String, see <a href="https://godoc.org/github.com/robfig/cron">Scheduling format</a> of the Go implementation of <code class="language-plaintext highlighter-rouge">cron</code>. E.g. <code class="language-plaintext highlighter-rouge">@every 10s</code> or <code class="language-plaintext highlighter-rouge">0 0 1 * * *</code> (every night at 1 AM). <strong>Note</strong>: the format starts with seconds, instead of minutes.</li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>Command</strong> *
    <ul>
      <li><em>description</em>: Command you want to run inside the container.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">touch /tmp/example</code></li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>Container</strong> *
    <ul>
      <li><em>description</em>: Name of the container you want to execute the command in.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">nginx-proxy</code></li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>User</strong>
    <ul>
      <li><em>description</em>: User as which the command should be executed, similar to <code class="language-plaintext highlighter-rouge">docker exec --user &lt;user&gt;</code></li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">www-data</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">root</code></li>
    </ul>
  </li>
  <li><strong>tty</strong>
    <ul>
      <li><em>description</em>: Allocate a pseudo-tty, similar to <code class="language-plaintext highlighter-rouge">docker exec -t</code>. See this <a href="https://stackoverflow.com/questions/30137135/confused-about-docker-t-option-to-allocate-a-pseudo-tty">Stack Overflow answer</a> for more info.</li>
      <li><em>value</em>: Boolean, either <code class="language-plaintext highlighter-rouge">false</code> or <code class="language-plaintext highlighter-rouge">true</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">false</code></li>
    </ul>
  </li>
  <li><strong>Workdir</strong>
    <ul>
      <li><em>description</em>: Working directory in which the command is executed, similar to <code class="language-plaintext highlighter-rouge">docker exec --workdir &lt;dir&gt;</code></li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">/app</code></li>
      <li><em>default</em>: Container’s default working directory</li>
    </ul>
  </li>
</ul>

<h3 id="ini-file-example">INI-file example</h3>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-exec "flush-nginx-logs"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@hourly</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">nginx-proxy</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">/bin/bash /flush-logs.sh</span>
<span class="py">user</span> <span class="p">=</span> <span class="s">www-data</span>
<span class="py">tty</span> <span class="p">=</span> <span class="s">false</span>
<span class="py">workdir</span> <span class="p">=</span> <span class="s">/var/log/nginx</span>
</code></pre></div></div>

<h3 id="docker-labels-example">Docker labels example</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.flush-nginx-logs.schedule<span class="o">=</span><span class="s2">"@hourly"</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.flush-nginx-logs.command<span class="o">=</span><span class="s2">"/bin/bash /flush-logs.sh"</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.flush-nginx-logs.user<span class="o">=</span><span class="s2">"www-data"</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.flush-nginx-logs.tty<span class="o">=</span><span class="s2">"false"</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.flush-nginx-logs.workdir<span class="o">=</span><span class="s2">"/var/log/nginx"</span> <span class="se">\</span>
        nginx
</code></pre></div></div>

<h2 id="job-run">Job-run</h2>

<p>This job can be used in 2 situations:</p>

<ol>
  <li>To run a command inside of a new container, using a specific image. Similar to <code class="language-plaintext highlighter-rouge">docker run</code></li>
  <li>To start a stopped container, similar to <code class="language-plaintext highlighter-rouge">docker start</code></li>
</ol>

<h3 id="parameters-2">Parameters</h3>

<ul>
  <li><strong>Schedule</strong> * (1,2)
    <ul>
      <li><em>description</em>: When the job should be executed. E.g. every 10 seconds or every night at 1 AM.</li>
      <li><em>value</em>: String, see <a href="https://godoc.org/github.com/robfig/cron">Scheduling format</a> of the Go implementation of <code class="language-plaintext highlighter-rouge">cron</code>. E.g. <code class="language-plaintext highlighter-rouge">@every 10s</code> or <code class="language-plaintext highlighter-rouge">0 0 1 * * *</code> (every night at 1 AM). <strong>Note</strong>: the format starts with seconds, instead of minutes.</li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>Command</strong> (1)
    <ul>
      <li><em>description</em>: Command you want to run inside the container.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">touch /tmp/example</code></li>
      <li><em>default</em>: Default container command</li>
    </ul>
  </li>
  <li><strong>Image</strong> (1)
    <ul>
      <li><em>description</em>: Image you want to use for the job.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">nginx:latest</code></li>
      <li><em>default</em>: No default. If left blank, Chadburn assumes you will specify a container to start (situation 2).</li>
    </ul>
  </li>
  <li><strong>User</strong> (1)
    <ul>
      <li><em>description</em>: User as which the command should be executed, similar to <code class="language-plaintext highlighter-rouge">docker run --user &lt;user&gt;</code></li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">www-data</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">root</code></li>
    </ul>
  </li>
  <li><strong>Network</strong> (1)
    <ul>
      <li><em>description</em>: Connect the container to this network</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">backend-proxy</code></li>
      <li><em>default</em>: Optional field, no default.</li>
    </ul>
  </li>
  <li><strong>Delete</strong> (1)
    <ul>
      <li><em>description</em>: Delete the container after the job is finished. Similar to <code class="language-plaintext highlighter-rouge">docker run --rm</code></li>
      <li><em>value</em>: Boolean, either <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">true</code></li>
    </ul>
  </li>
  <li><strong>Container</strong> (2)
    <ul>
      <li><em>description</em>: Name of the container you want to start.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">nginx-proxy</code></li>
      <li><em>default</em>: Required field in case parameter <code class="language-plaintext highlighter-rouge">image</code> is not specified, no default.</li>
    </ul>
  </li>
  <li><strong>tty</strong> (1,2)
    <ul>
      <li><em>description</em>: Allocate a pseudo-tty, similar to <code class="language-plaintext highlighter-rouge">docker exec -t</code>. See this <a href="https://stackoverflow.com/questions/30137135/confused-about-docker-t-option-to-allocate-a-pseudo-tty">Stack Overflow answer</a> for more info.</li>
      <li><em>value</em>: Boolean, either <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">false</code></li>
    </ul>
  </li>
  <li><strong>Volume</strong>
    <ul>
      <li><em>description</em>: Mount host machine directory into container as a <a href="https://docs.docker.com/storage/bind-mounts/#start-a-container-with-a-bind-mount">bind mount</a></li>
      <li><em>value</em>: Same format as used with <code class="language-plaintext highlighter-rouge">-v</code> flag within <code class="language-plaintext highlighter-rouge">docker run</code>. For example: <code class="language-plaintext highlighter-rouge">/tmp/test:/tmp/test:ro</code>
        <ul>
          <li><strong>INI config</strong>: <code class="language-plaintext highlighter-rouge">Volume</code> setting can be provided multiple times for multiple mounts.</li>
          <li><strong>Labels config</strong>: multiple mounts has to be provided as JSON array: <code class="language-plaintext highlighter-rouge">["/test/tmp:/test/tmp:ro", "/test/tmp:/test/tmp:rw"]</code></li>
        </ul>
      </li>
      <li><em>default</em>: Optional field, no default.</li>
    </ul>
  </li>
</ul>

<h3 id="ini-file-example-1">INI-file example</h3>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-run "print-write-date"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@every 5s</span>
<span class="py">image</span> <span class="p">=</span> <span class="s">alpine:latest</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">sh -c 'date | tee -a /tmp/test/date'</span>
<span class="py">volume</span> <span class="p">=</span> <span class="s">/tmp/test:/tmp/test:rw</span>
</code></pre></div></div>

<p>Then you can check output in host machine file <code class="language-plaintext highlighter-rouge">/tmp/test/date</code></p>

<h3 id="docker-compose-example">Docker Compose example</h3>

<p>When using <code class="language-plaintext highlighter-rouge">job-run</code> with Docker Compose, it’s important to understand that this job type is designed to:</p>
<ol>
  <li>Run a command in a <strong>new</strong> container using a specific image, or</li>
  <li>Start an <strong>existing stopped</strong> container</li>
</ol>

<p>It is <strong>not</strong> designed to run commands inside already running containers (use <code class="language-plaintext highlighter-rouge">job-exec</code> for that).</p>

<h4 id="example-1-running-a-command-in-a-new-container">Example 1: Running a command in a new container</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">chadburn</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">premoweb/chadburn:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">daemon</span>

  <span class="c1"># This container doesn't need to be running for the job to work</span>
  <span class="c1"># It just defines the job configuration</span>
  <span class="na">job-config</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">alpine:latest</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">chadburn.enabled</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">chadburn.job-run.periodic-task.schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@every</span><span class="nv"> </span><span class="s">5m"</span>
      <span class="na">chadburn.job-run.periodic-task.image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">alpine:latest"</span>
      <span class="na">chadburn.job-run.periodic-task.command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'date</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">tee</span><span class="nv"> </span><span class="s">-a</span><span class="nv"> </span><span class="s">/tmp/log'"</span>
      <span class="na">chadburn.job-run.periodic-task.volume</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/tmp:/tmp:rw"</span>
</code></pre></div></div>

<p>In this example, Chadburn will create a new Alpine container every 5 minutes to run the date command.</p>

<h4 id="example-2-starting-an-existing-container-periodically">Example 2: Starting an existing container periodically</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">chadburn</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">premoweb/chadburn:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">daemon</span>

  <span class="na">periodic-container</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">alpine:latest</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'date</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">tee</span><span class="nv"> </span><span class="s">-a</span><span class="nv"> </span><span class="s">/tmp/log'"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">chadburn.job-run.restart-me.schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@every</span><span class="nv"> </span><span class="s">30m"</span>
      <span class="na">chadburn.job-run.restart-me.container</span><span class="pi">:</span> <span class="s2">"</span><span class="s">periodic-container"</span>
</code></pre></div></div>

<p>In this example, the <code class="language-plaintext highlighter-rouge">periodic-container</code> will be started every 30 minutes. The container will execute its defined command each time it starts.</p>

<h4 id="common-mistake">Common Mistake</h4>

<p>A common mistake is trying to use <code class="language-plaintext highlighter-rouge">job-run</code> to execute commands inside a running container:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This will NOT work as expected</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">alpine</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span>
    <span class="c1"># This container will start and stay running</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tail</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">/dev/null"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">chadburn.enabled</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">chadburn.job-run.datecron.schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@every</span><span class="nv"> </span><span class="s">5s"</span>
      <span class="na">chadburn.job-run.datecron.command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">uname</span><span class="nv"> </span><span class="s">-a"</span>
</code></pre></div></div>

<p>This configuration will not run <code class="language-plaintext highlighter-rouge">uname -a</code> every 5 seconds inside the running Alpine container. Instead, use <code class="language-plaintext highlighter-rouge">job-exec</code> for that purpose:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Correct way to run commands in an existing container</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">alpine</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tail</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">/dev/null"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">chadburn.enabled</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">chadburn.job-exec.datecron.schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@every</span><span class="nv"> </span><span class="s">5s"</span>
      <span class="na">chadburn.job-exec.datecron.command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">uname</span><span class="nv"> </span><span class="s">-a"</span>
</code></pre></div></div>

<h3 id="running-chadburn-on-docker-example">Running Chadburn on Docker example</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock:ro <span class="se">\</span>
        premoewb/chadburn:latest daemon 
</code></pre></div></div>

<h2 id="job-local">Job-local</h2>

<p>Runs the command on the host running Chadburn.</p>

<p><strong>Note</strong>: In case Chadburn is running inside a container, the command is executed inside the container. Not on the Docker host.</p>

<h3 id="parameters-3">Parameters</h3>

<ul>
  <li><strong>Schedule</strong> *
    <ul>
      <li><em>description</em>: When the job should be executed. E.g. every 10 seconds or every night at 1 AM.</li>
      <li><em>value</em>: String, see <a href="https://godoc.org/github.com/robfig/cron">Scheduling format</a> of the Go implementation of <code class="language-plaintext highlighter-rouge">cron</code>. E.g. <code class="language-plaintext highlighter-rouge">@every 10s</code> or <code class="language-plaintext highlighter-rouge">0 0 1 * * *</code> (every night at 1 AM). <strong>Note</strong>: the format starts with seconds, instead of minutes.</li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>Command</strong> *
    <ul>
      <li><em>description</em>: Command you want to run on the host.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">touch test.txt</code></li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>Dir</strong>
    <ul>
      <li><em>description</em>: Base directory to execute the command.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">/tmp/sandbox/</code></li>
      <li><em>default</em>: Current directory</li>
    </ul>
  </li>
  <li><strong>Environment</strong> (Broken?)
    <ul>
      <li><em>description</em>: List of environment variables</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">FILE=test.txt</code></li>
      <li><em>default</em>: Optional field, no default.</li>
    </ul>
  </li>
</ul>

<h3 id="ini-file-example-2">INI-file example</h3>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-local "create-file"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@every 15s</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">touch test.txt</span>
<span class="py">dir</span> <span class="p">=</span> <span class="s">/tmp/</span>
</code></pre></div></div>

<h2 id="job-service-run">Job-service-run</h2>

<p>This job can be used to:</p>

<ul>
  <li>To run a command inside a new “run-once” service, for running inside a swarm.</li>
</ul>

<h3 id="parameters-4">Parameters</h3>

<ul>
  <li><strong>Schedule</strong> * (1,2)
    <ul>
      <li><em>description</em>: When the job should be executed. E.g. every 10 seconds or every night at 1 AM.</li>
      <li><em>value</em>: String, see <a href="https://godoc.org/github.com/robfig/cron">Scheduling format</a> of the Go implementation of <code class="language-plaintext highlighter-rouge">cron</code>. E.g. <code class="language-plaintext highlighter-rouge">@every 10s</code> or <code class="language-plaintext highlighter-rouge">0 0 1 * * *</code> (every night at 1 AM). <strong>Note</strong>: the format starts with seconds, instead of minutes.</li>
      <li><em>default</em>: Required field, no default.</li>
    </ul>
  </li>
  <li><strong>Command</strong> (1, 2)
    <ul>
      <li><em>description</em>: Command you want to run inside the container.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">touch /tmp/example</code></li>
      <li><em>default</em>: Default container command</li>
    </ul>
  </li>
  <li><strong>Image</strong> * (1)
    <ul>
      <li><em>description</em>: Image you want to use for the job.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">nginx:latest</code></li>
      <li><em>default</em>: No default. If left blank, Chadburn assumes you will specify a container to start (situation 2).</li>
    </ul>
  </li>
  <li><strong>Network</strong> (1)
    <ul>
      <li><em>description</em>: Connect the container to this network</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">backend-proxy</code></li>
      <li><em>default</em>: Optional field, no default.</li>
    </ul>
  </li>
  <li><strong>delete</strong> (1)
    <ul>
      <li><em>description</em>: Delete the container after the job is finished.</li>
      <li><em>value</em>: Boolean, either <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">true</code></li>
    </ul>
  </li>
  <li><strong>User</strong> (1,2)
    <ul>
      <li><em>description</em>: User as which the command should be executed.</li>
      <li><em>value</em>: String, e.g. <code class="language-plaintext highlighter-rouge">www-data</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">root</code></li>
    </ul>
  </li>
  <li><strong>tty</strong> (1,2)
    <ul>
      <li><em>description</em>: Allocate a pseudo-tty, similar to <code class="language-plaintext highlighter-rouge">docker exec -t</code>. See this <a href="https://stackoverflow.com/questions/30137135/confused-about-docker-t-option-to-allocate-a-pseudo-tty">Stack Overflow answer</a> for more info.</li>
      <li><em>value</em>: Boolean, either <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></li>
      <li><em>default</em>: <code class="language-plaintext highlighter-rouge">false</code></li>
    </ul>
  </li>
</ul>

<h3 id="ini-file-example-3">INI-file example</h3>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-service-run "service-executed-on-new-container"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">0,20,40 * * * *</span>
<span class="py">image</span> <span class="p">=</span> <span class="s">ubuntu</span>
<span class="py">network</span> <span class="p">=</span> <span class="s">swarm_network</span>
<span class="py">command</span> <span class="p">=</span>  <span class="s">touch /tmp/example</span>
</code></pre></div></div>

<h2 id="variable-substitution">Variable Substitution</h2>

<p>Chadburn supports variable substitution in job commands, allowing you to reference container information dynamically. This is particularly useful when you need to interact with containers without hardcoding their names or IDs.</p>

<h3 id="available-variables">Available Variables</h3>

<ul>
  <li><em>**</em> - The name of the container</li>
  <li><em>**</em> - The ID of the container</li>
</ul>

<h3 id="examples">Examples</h3>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[job-exec "restart-container"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@daily</span>
<span class="py">container</span> <span class="p">=</span> <span class="s">my-container</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">docker restart </span>

<span class="nn">[job-local "log-container-id"]</span>
<span class="py">schedule</span> <span class="p">=</span> <span class="s">@hourly</span>
<span class="py">command</span> <span class="p">=</span> <span class="s">echo "Container ID is " &gt;&gt; /var/log/containers.log</span>
</code></pre></div></div>

<p>With Docker labels:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.restart-self.schedule<span class="o">=</span><span class="s2">"@daily"</span> <span class="se">\</span>
    <span class="nt">--label</span> chadburn.job-exec.restart-self.command<span class="o">=</span><span class="s2">"docker restart "</span> <span class="se">\</span>
        nginx
</code></pre></div></div>

<p>This feature allows for more flexible and reusable job configurations, especially when working with dynamic container environments where container names or IDs might change.</p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/PremoWeb/Chadburn">chadburn</a> is maintained by <a href="https://github.com/PremoWeb">PremoWeb</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html> 